<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Websocket Test</title>
  </head>
  <body>
    <h2>Websocket Test</h2>

    <div id='log'></div>

    <form id="emit" method="POST" action='#'>
      <textarea cols="50" rows="5" name="emit_data" id="emit_data" placeholder="Message here."></textarea>
      <input type="submit" value="Run">
    </form>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.dev.js"></script>
    <script type="text/javascript" charset="utf-8">
      $(document).ready(function() {
        var url = 'http://192.168.56.101';
        var port = '8080';

        var socket = io.connect(url + ":" + port + "/test");

        socket.on('connect', function() {
          console.log("client connect event, sending first_event.")
          var message = {
            data: "connected!",
            cluster_id: "c-6rlzw",
            Authorization: "Bearer token-hxfsx:kqdf44kck5n4pdnjs4v22hchlvdb95g59xt5nmj75ldsgx2wnq695f",
            pod: "curl-debugger-56dc9dcd9b-q8kgn",
            namespace: "debugger"
          }
          socket.emit('first_event', message);
        });

        socket.on('server_response', function(msg) {
          console.log("client server_response, writing output to DOM.")
          console.log(msg.data)
          msg.data.split("\n").forEach(add_line_to_log);
        });

        $('form#emit').submit(function(event) {
          console.log("sending submit event.")
          socket.emit('submit_event', {data: $('#emit_data').val()});
          return false;
        });
        
        function add_line_to_log(value) {
          $('#log').append('<br>' + $('<div/>').text(value).html());
        }

        /*
        $('form#emit').submit(function(event) {
          socket.emit('submit_event', {data: $('#emit_data').val()});
          return false;
        });
        */
      });
    </script>
  </body>
</html>
